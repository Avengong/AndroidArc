# 心娱卡顿率口径统一

## 一、公司目前方案

### 氧气

- 卡顿标准： 单个帧渲染超过700ms，认为出现卡顿。

- 卡顿率： 只要发生过卡顿次数 >=1 的设备都定义为卡顿设备

```
卡顿率= 当天卡顿设备数/当天激活的设备数
```

- 目前问题： 卡顿率过高

### miya

Google的Android Vitas：

- 卡顿标准： 单个帧渲染耗时超过700ms，认为卡顿
- 卡顿率： 当>=700ms的帧数量大于活跃日总帧数的0.1%时，确定为卡顿设备。

```
卡顿率= 当天卡顿设备数/当天激活的设备数
```

- 缺点：活跃日总帧数不好统计

# 二、新的方案

## 业界参考

### 火山引擎

卡顿标准： 主线程大于2.5s卡顿 大于4s严重卡顿。以上是默认值，可以设置。

- 卡顿率

```  
卡顿率= 当天卡顿设备数/当天激活的设备数  
```

### 友盟

- 卡顿标准： 安卓卡顿分析默认的值为超过2秒计为卡顿，可设置。
- 卡顿率

```
卡顿率= 当天卡顿设备数/当天激活的设备数    
```

### 美团

- 卡顿标准： 有的卡顿连续性耗时较长，例如打开新页面时的卡顿；而有的卡顿连续性耗时相对较短但频次较快，例如列表滑动时的卡顿。

因此，我们采用了“N次卡顿超过阈值T”的判定策略，即一个时间段内卡顿的次数累计大于N时才触发采集和上报。

例如卡顿阈值T=2000ms、卡顿次数N=1，可以判定为单次耗时较长的卡顿；而卡顿阈值T=300ms、卡顿次数N=5，可以判定为频次较快的卡顿

但是具体到底多少毫秒算一次卡顿没有给出：

Hertz在实践中采用的就是检测主线程每次执行消息循环的时间，当这一时间大于阈值时，就记为发生一次卡顿。

- 卡顿率：

```
卡顿率= 当天卡顿设备数/当天激活的设备数 
```

- 优点：细分场景

## 心娱

- 卡顿标准：

综合来看，分为两类：

1. 主线程单次消息执行耗时 >阈值 则认为发生卡顿

不同点在于耗时阈值的大小问题。 到底多少一帧渲染超过ms卡顿才算卡顿？ 单次卡顿：700ms？ 2s？ 2.5s？

2. 发生卡顿多少次才算真正卡顿，触发上报？

2.1 如 某段时间/收集一定数量帧内，统计发生了卡顿的帧数。达到一个比例则触发上报 如 1000ms 连续发生了3次卡顿，当然卡顿标准肯定会低，如200ms才算一次轻微卡顿。 2.2
每次卡顿都上报，单个活跃日，总共发生了多少次卡顿，才算卡顿？

- 卡顿率：

龙龙的方案：

1. 20s上报一次卡顿情况 20s内发生多次卡顿算一次？？

```
单个活跃日内：
卡顿率= 卡顿次数/总上报次数

```

2. 上报卡顿时间

```
单个活跃日内：
卡顿率= 卡顿时长/总使用时长

```

关于使用时长：

- 可以通过没20s上报计算所得。
- 也可以通过后台统计获取。

参考：

(移动端性能监控方案Hertz)[https://tech.meituan.com/2016/12/19/hertz.html]







